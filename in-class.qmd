---
title: "Subdivision In-Class Activity"
format: 
  html:
    code-tools: true
    self-contained: true
editor: source
---

Population subdivision creates more realistic situations, where individuals in spatial proximity are more likely to mate with each other compared to individuals in different locales.  You will see a lot of terminology here, including population, deme, locale, subdivision, etc., all of which mean that one or more factors are challenging the fundamental assumption of random mating.  With subdivided populations, each individual's probability of mating depends upon which subdivision they reside in. This is mediated by connectivity, or gene flow (and migration if it is followed by mating).

In this quick section, we are going to focus on:

1.  Understanding how migration rates and population connectivity impact allele frequencies.

2.  Predict future allele frequencies.

3.  Communicate those findings.

## Population Connectivity

Consider the following connectivity graph of the three populations *x*, *y*, and *z*.

![](https://www.flickr.com/photo_download.gne?id=54918100312&secret=26265c0455&size=c&source=photoPageEngagement)

If the population start off with these frequencies.

```{r}
library( tidyverse )
px <- 0.2
py <- 0.8
pz <- 0.9
mxy <- 0.1 
mxz <- 0.2
myz <- 0.3
```

Estimate allele frequencies until equilibrium.

```{r}
N <- 100

data.frame( T = seq(0,N),
            px = c(px,rep(NA,N)),
            py = c(py,rep(NA,N)),
            pz = c(pz,rep(NA,N))) -> df
head(df)
```

```{r}

for( i in 2:N) { 
  
  df$px[i] <- df$px[(i-1)]*(1 - (mxy+mxz)) +  df$py[(i-1)] * mxy + df$pz[(i-1)] * mxz 
  df$py[i] <- df$py[(i-1)]*(1 - (mxy+myz)) +  df$px[(i-1)] * mxy + df$pz[(i-1)] * myz 
  df$pz[i] <- df$pz[(i-1)]*(1 - (mxz+myz)) +  df$px[(i-1)] * mxz + df$py[(i-1)] * myz 
  
  
}





```


```{r}
# plot the outcome
library( tidyverse )

#ggplot( df ) + 
#  geom_line( aes(T, px), col="red") + 
#  geom_line( aes(T, py), col="blue") + 
#  geom_line( aes(T, pz), col="green") +
#  theme_minimal()

pivot_longer( df, cols = c(px,py,pz) ) |>
  ggplot( aes(T,value, color=name) ) +
  geom_line() + 
  theme_minimal()


```


## Questions

Use the code above and 

1. What if $m_{y \leftrightarrow z}=0$, how does that change the trajectory in allele frequencies?

```{r}
# set myz=0, redo, and plot the allele frequencies for each population
```


2. Reset the connectivity from the last question to the original one and add a fourth population (`w`) to the model that is connected in a **one-way migration** from population `z` with a rate of $m_{z \rightarrow w} = 0.05$ and a starting allele frequency of 0.1.  Create a plot of allele frequencies through time with a sufficient number of generations to allow the system to reach allele frequency equilibrium.

```{r}
# add another population and plot allele frequencies.
```






